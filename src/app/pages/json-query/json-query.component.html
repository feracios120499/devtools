<div class="dt-container">
  <!-- Структурированные данные Schema.org добавляются в head через Renderer2 -->

  <app-page-header>Tool for querying and exploring JSON data with JavaScript expressions</app-page-header>


  <!-- Query input -->
  <div class="p-3 query-input-container">
    <p-autocomplete class="w-full" [(ngModel)]="queryString" [dropdown]="querySuggestions.length != 0"
      [suggestions]="querySuggestions" (completeMethod)="search($event)" (ngModelChange)="executeQuery()"
      (keydown.enter)="executeQuery()" (focusout)="saveQueryString()" />
    <small class="block mt-1 text-400">
      Start with <code class="text-primary px-1 rounded">data</code> to refer to the JSON object. Use JavaScript
      expressions.
    </small>
    <!-- Error message -->
    <div *ngIf="error" class="mt-2 rounded-md border-1 border-red-300 text-red-700">
      <i class="pi pi-exclamation-triangle mr-2"></i>{{ error }}
    </div>
  </div>

  <!-- Основной контейнер с редакторами -->
  <div class="dt-editors">
    <!-- Левая колонка - Input JSON -->
    <div class="col flex flex-col h-full">
      <div class="card p-3 surface-card shadow-sm flex-1 flex flex-col overflow-hidden h-full">
        <!-- Заголовок -->
        <div class="flex justify-between items-center h-10">
          <h3 class="text-xl font-medium text-800 m-0">JSON Input</h3>
        </div>
        <!-- Отступ для дропдауна -->
        <div class="mb-1"></div>

        <!-- Fallback textarea for server-side rendering -->
        <textarea *ngIf="!isBrowser" [(ngModel)]="inputJson" (ngModelChange)="formatJson()"
          class="w-full p-2 border-1 surface-100 font-mono flex-1">
        </textarea>

        <!-- Monaco editor for browser environment -->
        <div *ngIf="isBrowser"
          class="w-full h-full border-1 surface-border rounded-md flex-1 position-relative monaco-container dt-editors-editor"
          [class.fullscreen-editor]="isInputFullscreen" #inputEditorContainer>
          <div class="dt-editors-editor-actions">
            <div class="flex justify-between p-2">
              <div class="flex gap-3 align-items-center">
                <button pButton type="button" [outlined]="true" label="Sample" (click)="loadSampleJson()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="code" class="icon-sm"> </i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Paste" class="p-button-sm"
                  (click)="pasteFromClipboard()" severity="contrast">
                  <i-tabler name="clipboard" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Format" (click)="formatJson()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="align-justified" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Clear" (click)="clearJson()" severity="danger"
                  class=" p-button-sm">
                  <i-tabler name="trash" class="icon-sm"></i-tabler>
                </button>
              </div>
              <div class="flex align-items-center">
                <button *ngIf="!isInputFullscreen" pButton type="button" (click)="toggleFullscreen('input')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-maximize" class="icon-md"></i-tabler>
                </button>
                <button *ngIf="isInputFullscreen" pButton type="button" (click)="toggleFullscreen('input')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-minimize" class="icon-md"></i-tabler>
                </button>
              </div>
            </div>
            <hr>
          </div>
          <ngx-monaco-editor #inputMonacoEditor [options]="inputEditorOptions" [(ngModel)]="inputJson"
            class="w-full h-full">
          </ngx-monaco-editor>
        </div>
      </div>
    </div>

    <!-- Правая колонка - Query Result -->
    <div class="col flex flex-col h-full">
      <div class="card p-3 surface-card shadow-sm flex-1 flex flex-col overflow-hidden h-full">
        <!-- Заголовок -->
        <div class="flex justify-between items-center h-10">
          <h3 class="text-xl font-medium text-800 m-0">Query Result</h3>
        </div>
        <!-- Отступ для дропдауна -->
        <div class="mb-1"></div>

        <!-- Fallback textarea for server-side rendering -->
        <textarea *ngIf="!isBrowser" [(ngModel)]="queryResult" readonly
          class="w-full p-2 border-1 surface-100 font-mono flex-1">
        </textarea>

        <!-- Monaco editor for browser environment -->
        <div *ngIf="isBrowser"
          class="w-full h-full border-1 surface-border rounded-md flex-1 position-relative monaco-container dt-editors-editor"
          [class.fullscreen-editor]="isOutputFullscreen" #outputEditorContainer>
          <div class="dt-editors-editor-actions">
            <div class="flex justify-between p-2">
              <div class="flex gap-3 align-items-center">
                <button pButton type="button" [outlined]="true" label="Copy" (click)="copyToClipboard()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="copy" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Download" (click)="downloadResult()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="download" class="icon-sm"></i-tabler>
                </button>
              </div>
              <div class="flex align-items-center">
                <button *ngIf="!isOutputFullscreen" pButton type="button" (click)="toggleFullscreen('output')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-maximize" class="icon-md"></i-tabler>
                </button>
                <button *ngIf="isOutputFullscreen" pButton type="button" (click)="toggleFullscreen('output')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-minimize" class="icon-md"></i-tabler>
                </button>
              </div>
            </div>
            <hr>
          </div>
          <ngx-monaco-editor #outputMonacoEditor [options]="outputEditorOptions" [(ngModel)]="queryResult"
            class="w-full h-full">
          </ngx-monaco-editor>
        </div>
      </div>
    </div>
  </div>

  <!-- Information Section -->
  <div class="mt-4 p-3 border-round-lg surface-card shadow-sm border-1 surface-border info-section dt-about">
    <h4 class="text-xl font-semibold mb-2">About JSON Query Explorer</h4>
    <p class="mb-2 text-sm">
      This tool allows you to query and extract data from JSON using standard JavaScript expressions. The JSON data is
      assigned to a variable called <code class="text-primary px-1 rounded">data</code>, which you can use in your
      queries.
    </p>
    <p class="mb-2 text-sm">
      <strong>Example queries:</strong>
    </p>
    <ul class="list-disc pl-5 mb-2 text-sm space-y-2">
      <li><code class="text-primary px-1 rounded">data.users.filter(user => user.age > 30)</code> - Get users older than
        30</li>
      <li><code class="text-primary px-1 rounded">data.products.map(p => p.name)</code> - Extract names only</li>
      <li><code class="text-primary px-1 rounded">data.orders.reduce((sum, order) => sum + order.total, 0)</code> -
        Calculate total value</li>
      <li><code class="text-primary px-1 rounded">Object.keys(data.settings)</code> - Get all keys from settings object
      </li>
    </ul>
    <p class="text-sm">
      For more about JSON format and structure, visit 
      <a href="https://www.json.org/json-en.html" target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">JSON.org</a>.
    </p>
  </div>

  <!-- Additional Information Section -->
  <div class="mt-4 p-3 border-round-lg surface-card shadow-sm border-1 surface-border dt-about">
    <h4 class="text-xl font-semibold mb-3">Supported JavaScript Features</h4>
    <p class="mb-2 text-sm">
      You can use all valid JavaScript expressions, including filter, map,
      reduce, find, and standard object methods.
    </p>
    <ul class="list-disc pl-5 mb-3 text-sm space-y-1">
      <li><code class="text-primary px-1 rounded">filter()</code>, <code
          class="text-primary px-1 rounded">map()</code>, <code
          class="text-primary px-1 rounded">reduce()</code>, <code
          class="text-primary px-1 rounded">find()</code></li>
      <li>Object/array destructuring</li>
      <li>Optional chaining <code class="text-primary px-1 rounded">(?.)</code></li>
    </ul>
    <p class="text-sm">
      Learn more about <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" 
      target="_blank" rel="noopener noreferrer" class="text-blue-600 underline hover:text-blue-800">Array.filter()</a> 
      and other JavaScript methods on MDN.
    </p>
  </div>

  <div class="mt-4 p-3 border-round-lg surface-card shadow-sm border-1 surface-border dt-about">
    <h5 class="text-lg font-medium">FAQ</h5>
    <div class="text-sm">
      <div class="mb-2">
        <h6 class="font-medium">Do I need to install anything?</h6>
        <p class="ml-2">No — everything runs in the browser. No data is sent to any server.</p>
      </div>

      <div class="mb-2">
        <h6 class="font-medium">Can I use nested properties?</h6>
        <p class="ml-2">Yes, you can access deep properties using dot notation or optional chaining:
          <code class="text-primary px-1 rounded">data.user?.profile?.email</code>
        </p>
      </div>

      <div class="mb-2">
        <h6 class="font-medium">Is it safe to use?</h6>
        <p class="ml-2">Yes, all code is executed in a sandboxed environment in your browser. Nothing is stored or
          shared.</p>
      </div>
    </div>
  </div>
  <!-- Toast component -->
  <p-toast position="bottom-right"></p-toast>
</div>