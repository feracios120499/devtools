<div class="flex flex-col w-full h-full">
  <!-- Структурированные данные Schema.org добавляются в head через Renderer2 -->

  <div class="mb-2 p-3" appFavoritePage>
    <h4 class="text-lg text-700">Tool for converting JSON to environment variables, Docker .env, or YAML formats</h4>
  </div>

  <!-- Панель настроек -->
  <div class="card p-3 surface-card shadow-sm mb-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
      <div class="col">
        <label for="format" class="block text-700 mb-2">Output Format</label>
        <p-select [options]="formatOptions" [(ngModel)]="selectedFormat" 
                 optionLabel="label" (onChange)="onFormatChange()" 
                 styleClass="p-select-sm custom-select w-full" appendTo="body" inputId="format">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedFormat.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col" *ngIf="selectedFormat.value === 'yaml'">
        <label for="yamlSubformat" class="block text-700 mb-2">YAML Subformat</label>
        <p-select [options]="yamlSubformatOptions" [(ngModel)]="selectedYamlSubformat" 
                 optionLabel="label" (onChange)="onYamlSubformatChange()" 
                 styleClass="p-select-sm custom-select w-full" appendTo="body" inputId="yamlSubformat">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedYamlSubformat.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col">
        <label for="separator" class="block text-700 mb-2">Separator</label>
        <p-select [options]="separatorOptions" [(ngModel)]="selectedSeparator" 
                 optionLabel="label" (onChange)="onSeparatorChange()" 
                 styleClass="p-select-sm custom-select w-full" appendTo="body" inputId="separator">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedSeparator.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col">
        <label for="casePreservation" class="block text-700 mb-2">Key Case</label>
        <p-select [options]="casePreservationOptions" [(ngModel)]="selectedCasePreservation" 
                 optionLabel="label" (onChange)="onCasePreservationChange()" 
                 styleClass="p-select-sm custom-select w-full" appendTo="body" inputId="casePreservation">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedCasePreservation.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>
    </div>
  </div>

  <!-- Основной контейнер с редакторами -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 editor-columns">
    <!-- Левая колонка - Input JSON -->
    <div class="col">
      <div class="card p-3 surface-card shadow-sm editor-container">
        <!-- Заголовок -->
        <div class="editor-header">
          <h5 class="text-xl font-medium text-800 m-0">JSON Input</h5>
          <div class="flex gap-2">
            <button pButton type="button" label="Paste" icon="pi pi-clipboard" (click)="pasteFromClipboard()"
              class="p-button-text p-button-sm"></button>
            <button pButton type="button" label="Sample" icon="pi pi-code" (click)="loadSampleJson()"
              class="p-button-text p-button-sm"></button>
            <button pButton type="button" label="Clear" icon="pi pi-trash" (click)="clearJson()" severity="danger"
              class="p-button-text p-button-sm"></button>
            <button pButton type="button" label="Format" icon="pi pi-align-justify" (click)="formatJson()"
              class="p-button-text p-button-sm"></button>
          </div>
        </div>

        <!-- Содержимое редактора -->
        <div class="editor-content">
          <!-- Fallback textarea for server-side rendering -->
          <textarea *ngIf="!isBrowser" [(ngModel)]="inputCode" (ngModelChange)="formatJson()"
            class="w-full p-2 border-1 surface-100 editor-input">
          </textarea>

          <!-- Monaco editor for browser environment -->
          <div *ngIf="isBrowser" class="monaco-container">
            <ngx-monaco-editor #inputMonacoEditor [options]="inputEditorOptions" [(ngModel)]="inputCode"
              (ngModelChange)="convertJsonToEnv()" class="w-full h-full editor-container">
            </ngx-monaco-editor>
          </div>
        </div>
      </div>
    </div>

    <!-- Правая колонка - ENV Output -->
    <div class="col">
      <div class="card p-3 surface-card shadow-sm editor-container">
        <!-- Заголовок -->
        <div class="editor-header">
          <h5 class="text-xl font-medium text-800 m-0">
            {{ selectedFormat.value === 'docker' ? 'ENV Output' : 'YAML Output' }}
          </h5>
          <div class="flex gap-2">
            <button pButton type="button" label="Copy" icon="pi pi-copy" (click)="copyToClipboard()"
              class="p-button-text p-button-sm"></button>
            <button pButton type="button" label="Download" icon="pi pi-download" (click)="downloadOutput()"
              class="p-button-text p-button-sm"></button>
          </div>
        </div>

        <!-- Содержимое редактора -->
        <div class="editor-content">
          <!-- Fallback textarea for server-side rendering -->
          <textarea *ngIf="!isBrowser" [(ngModel)]="outputCode" readonly
            class="w-full p-2 border-1 surface-100 editor-output">
          </textarea>

          <!-- Monaco editor for browser environment -->
          <div *ngIf="isBrowser" class="monaco-container">
            <ngx-monaco-editor #outputMonacoEditor [options]="outputEditorOptions" [(ngModel)]="outputCode"
              class="w-full h-full editor-container">
            </ngx-monaco-editor>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Information Section -->
  <div class="mt-4 p-3 border-round-lg surface-card shadow-sm border-1 surface-border info-section">
    <h3 class="text-xl font-semibold mb-2">About JSON to ENV Converter</h3>
    <p class="mb-2 text-sm">
      This tool allows you to convert JSON data into environment variables, Docker .env files, or YAML configurations. Perfect for setting up configuration for Docker containers, Kubernetes deployments, or any application that uses environment variables.
    </p>
    <p class="mb-2 text-sm">
      <strong>Features:</strong>
    </p>
    <ul class="list-disc pl-5 mb-2 text-sm space-y-2">
      <li><strong>Multiple output formats:</strong> Convert to Docker .env format or various YAML formats</li>
      <li><strong>YAML subformats:</strong> Support for Docker, Compose, Kubernetes, and Azure App Settings formats</li>
      <li><strong>Custom separators:</strong> Use colon (:) or underscores (__) as separators for nested keys</li>
      <li><strong>Case preservation:</strong> Choose whether to preserve original key case or convert to uppercase</li>
      <li><strong>Automatic nesting:</strong> Hierarchical JSON objects are automatically flattened with the selected separator</li>
    </ul>
    <p class="text-sm text-500">
      <i class="pi pi-info-circle mr-1"></i> JSON values will be automatically escaped according to the selected output format conventions.
    </p>
  </div>

  <!-- Toast component -->
  <p-toast position="bottom-right"></p-toast>
</div> 