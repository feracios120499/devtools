<div class="dt-container">
  <!-- Структурированные данные Schema.org добавляются в head через Renderer2 -->

  <app-page-header>Tool for converting JSON to environment variables, Docker .env, or YAML formats</app-page-header>

  <!-- Панель настроек -->
  <div class="card p-3 surface-card shadow-sm mb-4">
    <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
      <div class="col">
        <label for="format" class="block text-700 mb-2">Output Format</label>
        <p-select [options]="formatOptions" [(ngModel)]="selectedFormat" optionLabel="label"
          (onChange)="onFormatChange()" styleClass="p-select-sm custom-select w-full" appendTo="body" inputId="format">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedFormat.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col" *ngIf="selectedFormat.value === 'yaml'">
        <label for="yamlSubformat" class="block text-700 mb-2">YAML Subformat</label>
        <p-select [options]="yamlSubformatOptions" [(ngModel)]="selectedYamlSubformat" optionLabel="label"
          (onChange)="onYamlSubformatChange()" styleClass="p-select-sm custom-select w-full" appendTo="body"
          inputId="yamlSubformat">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedYamlSubformat.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col">
        <label for="separator" class="block text-700 mb-2">Separator</label>
        <p-select [options]="separatorOptions" [(ngModel)]="selectedSeparator" optionLabel="label"
          (onChange)="onSeparatorChange()" styleClass="p-select-sm custom-select w-full" appendTo="body"
          inputId="separator">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedSeparator.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>

      <div class="col">
        <label for="casePreservation" class="block text-700 mb-2">Key Case</label>
        <p-select [options]="casePreservationOptions" [(ngModel)]="selectedCasePreservation" optionLabel="label"
          (onChange)="onCasePreservationChange()" styleClass="p-select-sm custom-select w-full" appendTo="body"
          inputId="casePreservation">
          <ng-template pTemplate="selectedItem">
            <div class="flex align-items-center">
              <span>{{selectedCasePreservation.label}}</span>
            </div>
          </ng-template>
          <ng-template let-option pTemplate="item">
            <div class="flex align-items-center">
              <span>{{option.label}}</span>
            </div>
          </ng-template>
        </p-select>
      </div>
    </div>
  </div>

  <!-- Основной контейнер с редакторами -->
  <div class="dt-editors">
    <!-- Левая колонка - Input JSON -->
    <div class="col flex flex-col h-full">
      <div class="card p-3 surface-card shadow-sm flex-1 flex flex-col overflow-hidden h-full">
        <!-- Заголовок -->
        <div class="flex justify-between items-center h-10">
          <h5 class="text-xl font-medium text-800 m-0">JSON Input</h5>
        </div>
        <!-- Отступ для дропдауна -->
        <div class="mb-1"></div>

        <!-- Fallback textarea for server-side rendering -->
        <textarea *ngIf="!isBrowser" [(ngModel)]="inputCode" (ngModelChange)="convertJsonToEnv()"
          class="w-full p-2 border-1 surface-100 font-mono flex-1">
        </textarea>

        <!-- Monaco editor for browser environment -->
        <div *ngIf="isBrowser"
          class="w-full h-full border-1 surface-border rounded-md flex-1 position-relative monaco-container dt-editors-editor"
          [class.fullscreen-editor]="isInputFullscreen" #inputEditorContainer>
          <div class="dt-editors-editor-actions">
            <div class="flex justify-between p-2">
              <div class="flex gap-3 align-items-center">
                <button pButton type="button" [outlined]="true" label="Sample" (click)="loadSampleJson()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="code" class="icon-sm"> </i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Paste" class="p-button-sm"
                  (click)="pasteFromClipboard()" severity="contrast">
                  <i-tabler name="clipboard" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Format" (click)="formatJson()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="align-justified" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Clear" (click)="clearJson()" severity="danger"
                  class=" p-button-sm">
                  <i-tabler name="trash" class="icon-sm"></i-tabler>
                </button>

              </div>
              <div class="flex align-items-center">
                <button *ngIf="!isInputFullscreen" pButton type="button" (click)="toggleFullscreen('input')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-maximize" class="icon-md"></i-tabler>
                </button>
                <button *ngIf="isInputFullscreen" pButton type="button" (click)="toggleFullscreen('input')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-minimize" class="icon-md"></i-tabler>
                </button>
              </div>
            </div>
            <hr>
          </div>
          <ngx-monaco-editor #inputMonacoEditor [options]="inputEditorOptions" [(ngModel)]="inputCode"
            (ngModelChange)="convertJsonToEnv()" class="w-full h-full">
          </ngx-monaco-editor>
        </div>
      </div>
    </div>

    <!-- Правая колонка - ENV Output -->
    <div class="col flex flex-col h-full">
      <div class="card p-3 surface-card shadow-sm flex-1 flex flex-col overflow-hidden h-full">
        <!-- Заголовок -->
        <div class="flex justify-between items-center h-10">
          <h5 class="text-xl font-medium text-800 m-0">
            {{ selectedFormat.value === 'docker' ? 'ENV Output' : 'YAML Output' }}
          </h5>
        </div>
        <!-- Отступ для дропдауна -->
        <div class="mb-1"></div>

        <!-- Fallback textarea for server-side rendering -->
        <textarea *ngIf="!isBrowser" [(ngModel)]="outputCode" readonly
          class="w-full p-2 border-1 surface-100 font-mono flex-1">
        </textarea>

        <!-- Monaco editor for browser environment -->
        <div *ngIf="isBrowser"
          class="w-full h-full border-1 surface-border rounded-md flex-1 position-relative monaco-container dt-editors-editor"
          [class.fullscreen-editor]="isOutputFullscreen" #outputEditorContainer>
          <div class="dt-editors-editor-actions">
            <div class="flex justify-between p-2">
              <div class="flex gap-3 align-items-center">
                <button pButton type="button" [outlined]="true" label="Copy" (click)="copyToClipboard()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="copy" class="icon-sm"></i-tabler>
                </button>
                <button pButton type="button" [outlined]="true" label="Download" (click)="downloadOutput()"
                  class="p-button-sm" severity="contrast">
                  <i-tabler name="download" class="icon-sm"></i-tabler>
                </button>
              </div>
              <div class="flex align-items-center">
                <button *ngIf="!isOutputFullscreen" pButton type="button" (click)="toggleFullscreen('output')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-maximize" class="icon-md"></i-tabler>
                </button>
                <button *ngIf="isOutputFullscreen" pButton type="button" (click)="toggleFullscreen('output')"
                  severity="contrast" class="p-button-text p-button-sm">
                  <i-tabler name="arrows-minimize" class="icon-md"></i-tabler>
                </button>
              </div>
            </div>
            <hr>
          </div>
          <ngx-monaco-editor #outputMonacoEditor [options]="outputEditorOptions" [(ngModel)]="outputCode"
            class="w-full h-full">
          </ngx-monaco-editor>
        </div>
      </div>
    </div>
  </div>

  <!-- Information Section -->
  <div class="mt-4 p-3 border-round-lg surface-card shadow-sm border-1 surface-border info-section dt-about">
    <h3 class="text-xl font-semibold mb-2">About JSON to ENV Converter</h3>
    <p class="mb-2 text-sm">
      This tool allows you to convert JSON data into environment variables, Docker .env files, or YAML configurations.
      Perfect for setting up configuration for Docker containers, Kubernetes deployments, or any application that uses
      environment variables.
    </p>
    <p class="mb-2 text-sm">
      <strong>Features:</strong>
    </p>
    <ul class="list-disc pl-5 mb-2 text-sm space-y-2">
      <li><strong>Multiple output formats:</strong> Convert to Docker .env format or various YAML formats</li>
      <li><strong>YAML subformats:</strong> Support for Docker, Compose, Kubernetes, and Azure App Settings formats</li>
      <li><strong>Custom separators:</strong> Use colon (:) or underscores (__) as separators for nested keys</li>
      <li><strong>Case preservation:</strong> Choose whether to preserve original key case or convert to uppercase</li>
      <li><strong>Automatic nesting:</strong> Hierarchical JSON objects are automatically flattened with the selected
        separator</li>
    </ul>
    <p class="text-sm text-500">
      <i class="pi pi-info-circle mr-1"></i> JSON values will be automatically escaped according to the selected output
      format conventions.
    </p>
  </div>

  <!-- Toast component -->
  <p-toast position="bottom-right"></p-toast>
</div>